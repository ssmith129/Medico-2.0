<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>AI Inbox Triage Demo | Symplify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/node_modules/@tabler/icons-webfont/dist/tabler-icons.css">
  <link rel="stylesheet" href="/src/style/css/style.css">
  <link rel="stylesheet" href="./assets/ai-features.css">
</head>
<body>
  <div class="page-wrapper">
    <div class="content pb-0 p-4">
      <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
          <h4 class="fw-bold mb-1">AI Inbox Triage Demo</h4>
          <p class="text-muted mb-0">AI-powered message classification and prioritization</p>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="ai-chip ai-chip-robot"><i class="ti ti-robot"></i>&nbsp;AI Triage Active</span>
          <span class="ai-chip ai-chip-brain"><i class="ti ti-brain"></i>&nbsp;Smart Sorting</span>
          <span id="confidenceChip" class="ai-chip ai-chip-confidence"><i class="ti ti-activity"></i>&nbsp;Confidence: 0%</span>
        </div>
      </div>

      <div class="row g-4">
        <div class="col-xl-4">
          <div class="card ai-card">
            <div class="card-header"><h6 class="fw-semibold mb-0">AI Summary</h6></div>
            <div class="card-body d-grid gap-3">
              <div class="ai-stat"><span class="dot dot-critical pulse"></span><span class="flex-grow-1">Critical</span><strong id="sumCritical">0</strong></div>
              <div class="ai-stat"><span class="dot dot-high"></span><span class="flex-grow-1">High</span><strong id="sumHigh">0</strong></div>
              <div class="ai-stat"><span class="dot dot-medium"></span><span class="flex-grow-1">Medium</span><strong id="sumMedium">0</strong></div>
              <div class="ai-stat"><span class="dot dot-low"></span><span class="flex-grow-1">Low</span><strong id="sumLow">0</strong></div>
            </div>
          </div>
        </div>
        <div class="col-xl-8">
          <div class="card ai-card">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h6 class="fw-semibold mb-0">Inbox</h6>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-secondary" data-filter="All">All</button>
                <button class="btn btn-sm btn-outline-danger" data-filter="Critical">Critical</button>
                <button class="btn btn-sm btn-outline-warning" data-filter="High">High</button>
                <button class="btn btn-sm btn-outline-info" data-filter="Medium">Medium</button>
                <button class="btn btn-sm btn-outline-success" data-filter="Low">Low</button>
              </div>
            </div>
            <div class="card-body">
              <div id="inboxList" class="list-group"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { classifyMessage, confidenceFor, badgeForPriority, PRIORITY } from './assets/ai-utils.js';
    const messages = [
      { id:1, from:'ER Nurse', text:'Emergency: patient with chest pain arriving in 5 minutes' },
      { id:2, from:'Radiology', text:'CT scan results available for review. Possible micro-bleed.' },
      { id:3, from:'Reception', text:'Appointment reschedule requested for John Doe at 3 PM' },
      { id:4, from:'Billing', text:'Invoice discrepancy for patient #39421' },
      { id:5, from:'Dr. Lee', text:'Prescription refill needed for Maria Gomez' },
      { id:6, from:'Patient Portal', text:'Follow-up question about post-op care' },
    ];

    const enriched = messages.map(m=>{ const c=classifyMessage(m.text); return {...m, ...c, confidence:confidenceFor(c.priority)} })
    const sums = {Critical:0, High:0, Medium:0, Low:0};
    enriched.forEach(m=>sums[m.priority]++);

    document.getElementById('sumCritical').innerText = sums.Critical;
    document.getElementById('sumHigh').innerText = sums.High;
    document.getElementById('sumMedium').innerText = sums.Medium;
    document.getElementById('sumLow').innerText = sums.Low;
    const avgConf = Math.round(enriched.reduce((a,b)=>a+b.confidence,0)/enriched.length*100);
    document.getElementById('confidenceChip').innerHTML = `<i class='ti ti-activity'></i>&nbsp;Confidence: ${avgConf}%`;

    const inboxEl = document.getElementById('inboxList');
    function render(filter='All'){
      inboxEl.innerHTML = '';
      enriched.filter(m=> filter==='All' || m.priority===filter).forEach(m=>{
        const item = document.createElement('a');
        item.className='list-group-item list-group-item-action d-flex align-items-start gap-3';
        item.href='#';
        item.innerHTML = `
          <div class='flex-grow-1'>
            <div class='d-flex justify-content-between align-items-center mb-1'>
              <strong>${m.from}</strong>
              <span>${badgeForPriority(m.priority)}</span>
            </div>
            <div class='text-muted'>${m.text}</div>
            <div class='mt-1 d-flex gap-2'>
              <span class='badge rounded-pill text-bg-light'><i class='ti ti-calendar'></i> Urgency ${m.urgency}/5</span>
              <span class='badge rounded-pill text-bg-light'><i class='ti ti-percentage'></i> ${Math.round(m.confidence*100)}%</span>
            </div>
          </div>`;
        inboxEl.appendChild(item);
      })
    }
    render();

    document.querySelectorAll('[data-filter]').forEach(btn=>{
      btn.addEventListener('click',()=> render(btn.getAttribute('data-filter')))
    })
  </script>
</body>
</html>
